<import src="../common/card.wxml" />

<view class="top-stick" wx:if="{{init && finished && !closed}}">
  <view class="top-stick-hd">
    {{currentStory}}
  </view>
  <view class="top-stick-ft">
    <button bindtap="onAddTap">
      <image src="{{addStoryIconUrl}}"></image>
    </button>
  </view>
</view>
<view class="top-stick top-stick-story" wx:if="{{init && isHost && !finished}}">
  <view class="top-stick-hd">
    {{currentStory}}
  </view>
  <view class="top-stick-bd">
    {{displayTime}}
  </view>
  <view class="top-stick-ft">
    <button open-type="share">
      <image src="{{inviteIconUrl}}"></image>
    </button>
  </view>
</view>
<view class="container" wx:if="{{init}}">
  <view class="page-body">
    <view class="page-section" wx:if="{{(!isHost || needScore) && !finished}}">
      <view class="page-section-spacing">
        <view class="card-grids">
          <view class="card-grid" wx:for="{{cards}}" wx:for-item="card" wx:key="card.key">
            <template is="card" data="{{ card: card, selectedCard: selectedCard }}" />
          </view>
        </view>
      </view>
    </view>
    <view class="page-section-title" wx:if="{{!finished}}">Players</view>
    <view class="page-section" wx:if="{{!finished}}">
      <view class="page-section-spacing">
        <view class="player-box" wx:if="{{players && players.length}}">
          <view class="player" wx:for="{{players}}" wx:for-item="player" wx:key="player.avatarUrl">
            <view class="player-hd">
              <image class="player-avatar" src="{{player.avatarUrl}}"></image>
            </view>
            <view class="player-bd">
              {{player.nickName}}
            </view>
            <view class="player-ft">
              <view class="player-value" wx:if="{{player.score}}">{{player.score}}</view>
              <icon class="icon-small" wx:if="{{player.showCheck}}" type="success" size="23" color="#0678C1"></icon>
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="page-section-title" wx:if="{{!finished && isHost}}">Result Calculation</view>
    <view class="page-section" wx:if="{{!finished && isHost}}">
      <view class="page-section-spacing">
        <view class="result-box">
          <picker bindchange="onCalcMethodChange" value="{{calcMethod}}" range="{{calcMethods}}" range-key="key">
            <view class="result">
              <view class="result-bd">{{calcMethods[calcMethod].key}}</view>
              <view class="result-ft"></view>
            </view>
          </picker>
          <picker wx:if="{{calcMethods[calcMethod].sub}}" bindchange="onSubCalcMethodChange" value="{{subCalcMethod}}" range="{{calcMethods[calcMethod].sub}}" range-key="key">
            <view class="result">
              <view class="result-bd">{{calcMethods[calcMethod].sub[subCalcMethod].key}}</view>
              <view class="result-ft"></view>
            </view>
          </picker>
          <picker bindchange="onResultChange" value="{{result}}" range="{{results}}">
            <view class="result result-box-ft">
              <view class="result-bd">Result</view>
              <view class="result-ft">{{result ? results[result] : ''}}</view>
            </view>
          </picker>
        </view>
      </view>
    </view>
    <view class="btn-area" wx:if="{{!finished && isHost}}">
      <button type="primary" loading="{{loading}}" bindtap="onSaveTap">Save & Next</button>
    </view>
    <view class="page-section-divide" wx:if="{{!finished && isHost}}"></view>
    <view class="page-section-title" wx:if="{{scores && scores.length}}">All Stories</view>
    <view class="page-section" wx:if="{{scores && scores.length}}">
      <view class="page-section-spacing">
        <view class="story-box">
          <view class="story" wx:for="{{scores}}" wx:for-item="story" wx:key="story.index">
            <view class="story-hd">
              {{story.name}}
            </view>
            <view class="story-bd">
              {{story.time}}
            </view>
            <view class="story-ft">
              {{story.score}}
            </view>
          </view>
          <view class="story story-box-ft" wx:if="{{finished}}">
            <view class="story-hd">
              {{count}}
            </view>
            <view class="story-bd">
              {{time}}
            </view>
            <view class="story-ft">
              {{total}}
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="btn-area" wx:if="{{finished}}">
      <button type="primary" loading="{{loading}}" bindtap="onBackTap">Back</button>
    </view>
  </view>
</view>
